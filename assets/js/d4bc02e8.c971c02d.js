"use strict";(self.webpackChunkconvenient_service_docs=self.webpackChunkconvenient_service_docs||[]).push([[6729,7918],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>b});var r=t(7294);function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){s(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,s=function(e,n){if(null==e)return{};var t,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,s=e.mdxType,i=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=c(t),b=s,m=d["".concat(l,".").concat(b)]||d[b]||p[b]||i;return t?r.createElement(m,a(a({ref:n},u),{},{components:t})):r.createElement(m,a({ref:n},u))}));function b(e,n){var t=arguments,s=n&&n.mdxType;if("string"==typeof e||s){var i=t.length,a=new Array(i);a[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:s,a[1]=o;for(var c=2;c<i;c++)a[c]=t[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},5162:(e,n,t)=>{t.d(n,{Z:()=>a});var r=t(7294),s=t(6010);const i="tabItem_Ymn6";function a(e){let{children:n,hidden:t,className:a}=e;return r.createElement("div",{role:"tabpanel",className:(0,s.Z)(i,a),hidden:t},n)}},5488:(e,n,t)=>{t.d(n,{Z:()=>b});var r=t(7462),s=t(7294),i=t(6010),a=t(2389),o=t(7392),l=t(7094),c=t(2466);const u="tabList__CuJ",p="tabItem_LNqP";function d(e){var n;const{lazy:t,block:a,defaultValue:d,values:b,groupId:m,className:_}=e,f=s.Children.map(e.children,(e=>{if((0,s.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),h=b??f.map((e=>{let{props:{value:n,label:t,attributes:r}}=e;return{value:n,label:t,attributes:r}})),v=(0,o.l)(h,((e,n)=>e.value===n.value));if(v.length>0)throw new Error(`Docusaurus error: Duplicate values "${v.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const k=null===d?d:d??(null==(n=f.find((e=>e.props.default)))?void 0:n.props.value)??f[0].props.value;if(null!==k&&!h.some((e=>e.value===k)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${k}" but none of its children has the corresponding value. Available values are: ${h.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:w,setTabGroupChoices:y}=(0,l.U)(),[g,N]=(0,s.useState)(k),S=[],{blockElementScrollPositionUntilNextRender:C}=(0,c.o5)();if(null!=m){const e=w[m];null!=e&&e!==g&&h.some((n=>n.value===e))&&N(e)}const T=e=>{const n=e.currentTarget,t=S.indexOf(n),r=h[t].value;r!==g&&(C(n),N(r),null!=m&&y(m,String(r)))},x=e=>{var n;let t=null;switch(e.key){case"ArrowRight":{const n=S.indexOf(e.currentTarget)+1;t=S[n]??S[0];break}case"ArrowLeft":{const n=S.indexOf(e.currentTarget)-1;t=S[n]??S[S.length-1];break}}null==(n=t)||n.focus()};return s.createElement("div",{className:(0,i.Z)("tabs-container",u)},s.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":a},_)},h.map((e=>{let{value:n,label:t,attributes:a}=e;return s.createElement("li",(0,r.Z)({role:"tab",tabIndex:g===n?0:-1,"aria-selected":g===n,key:n,ref:e=>S.push(e),onKeyDown:x,onFocus:T,onClick:T},a,{className:(0,i.Z)("tabs__item",p,null==a?void 0:a.className,{"tabs__item--active":g===n})}),t??n)}))),t?(0,s.cloneElement)(f.filter((e=>e.props.value===g))[0],{className:"margin-top--md"}):s.createElement("div",{className:"margin-top--md"},f.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==g})))))}function b(e){const n=(0,a.Z)();return s.createElement(d,(0,r.Z)({key:String(n)},e))}},8573:(e,n,t)=>{t.d(n,{Z:()=>a});var r=t(7410),s=t(7294),i=t(814);(void 0!==t.g?t.g:window).Prism=r.Z,t(9385),t(6512);function a(e){let{children:n,...t}=e;return s.createElement(s.Fragment,null,s.createElement(i.Z,t,(e=>{let n=e.toString().split("\n");n=""===n[0]?n.slice(1):n;const t=n.find((e=>e.length)).search(/[^ ]/),r=-1===t?0:t;return n.map((e=>e.trimEnd())).map((e=>"-"===e.trimStart()?"":e)).map((e=>e.slice(r))).join("\n")})(n)))}},9494:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>c,default:()=>m,frontMatter:()=>l,metadata:()=>u,toc:()=>d});var r=t(7462),s=(t(7294),t(3905)),i=t(5488),a=t(5162),o=t(8573);const l={slug:"/best_practices/services_with_or_conditionals",sidebar_position:3,title:"Services with `or` conditionals"},c=void 0,u={unversionedId:"best_practices/services_with_or_conditionals",id:"best_practices/services_with_or_conditionals",title:"Services with `or` conditionals",description:"Convenient Service shines very brightly when you have and conditional logic.",source:"@site/docs/best_practices/services_with_or_conditionals.mdx",sourceDirName:"best_practices",slug:"/best_practices/services_with_or_conditionals",permalink:"/best_practices/services_with_or_conditionals",draft:!1,editUrl:"https://github.com/marian13/convenient_service_docs/blob/main/docs/best_practices/services_with_or_conditionals.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{slug:"/best_practices/services_with_or_conditionals",sidebar_position:3,title:"Services with `or` conditionals"},sidebar:"docs",previous:{title:"Service has only one `success`",permalink:"/best_practices/service_has_only_one_success"},next:{title:"Skip `result` call for boolean services",permalink:"/best_practices/skip_result_call_for_boolean_services"}},p={},d=[],b={toc:d};function m(e){let{components:n,...t}=e;return(0,s.kt)("wrapper",(0,r.Z)({},b,t,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"/"},"Convenient Service")," shines very brightly when you have ",(0,s.kt)("inlineCode",{parentName:"p"},"and")," conditional logic."),(0,s.kt)("p",null,"It is very easy to construct such behavior using the ",(0,s.kt)("inlineCode",{parentName:"p"},"step")," DSL."),(0,s.kt)("p",null,"Check out the following service:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ruby"},"class RefreshSubscription\n  include ::ConvenientService::Standard::Config\n\n  attr_reader :user, :subscription_id\n\n  step IsSubscriptionOwner,\n    in: [:user, :subscription_id]\n\n  step FindSubscription,\n    in: :subscription_id,\n    out: :subscription\n\n  step RegenerateSubscriptionTokens\n    in: :subscription,\n    out: :tokens\n\n  step UploadSubscriptionTokens\n    in: :subscription,\n    out: :tokens\n\n  def initialize(:user, :subscription_id)\n    @user = user\n    @subscription_id = subscription_id\n  end\nend\n")),(0,s.kt)("p",null,"Let's use the pseudo notation below to describe a sequence of steps from ",(0,s.kt)("inlineCode",{parentName:"p"},"RefreshSubscription")," as ",(0,s.kt)("inlineCode",{parentName:"p"},"and")," conditionals:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ruby"},"`IsSubscriptionOwner`\n  and `FindSubscription`\n  and `RegenerateSubscriptionTokens`\n  and `UploadSubscriptionTokens`.\n")),(0,s.kt)("p",null,"Pretty simple and straightforward."),(0,s.kt)("p",null,"But, but, but \ud83d\ude22..."),(0,s.kt)("p",null,"What should we do when we have some ",(0,s.kt)("inlineCode",{parentName:"p"},"or")," conditionals?"),(0,s.kt)("p",null,"For example, two additional requirements are introduced to the one we had before:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"Super admin can refresh any user subscriptions.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"A user with a special ability can refresh other user's subscriptions.")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("p",{parentName:"li"},"User can refresh its own subscription (already existing requirement)."))),(0,s.kt)("p",null,"In our pseudo notation it will look like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-ruby"},"`IsSuperAdmin` or `HasAbility`or `IsSubscriptionOwner`\n  and `FindSubscription`\n  and `RegenerateSubscriptionTokens`\n  and `UploadSubscriptionTokens`\n")),(0,s.kt)("p",null,"It is not the time to give up \ud83d\ude2d."),(0,s.kt)("p",null,"The list of to-do actions is not so long:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Create a new service which name generalizes all ",(0,s.kt)("inlineCode",{parentName:"p"},"or")," conditions, for instance - ",(0,s.kt)("inlineCode",{parentName:"p"},"IsAuthorizedForSubscriptionRefresh"),"."),(0,s.kt)("p",{parentName:"li"},"Then the updated pseudo notation can be displayed as:"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-ruby"},"`IsAuthorizedForSubscriptionRefresh`\n  and `FindSubscription`\n  and `RegenerateSubscriptionTokens`\n  and `UploadSubscriptionTokens`\n")),(0,s.kt)("p",{parentName:"li"},"Now, we can utilize all the ",(0,s.kt)("a",{parentName:"p",href:"/basics/step_to_result_translation_table"},(0,s.kt)("inlineCode",{parentName:"a"},"step")," DSL")," s usual."),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-ruby"},"class RefreshSubscription\n  # ...\n\n  step IsAuthorizedForSubscriptionRefresh,\n    in: [:user, :subscription_id]\n\n  step FindSubscription,\n    in: :subscription_id,\n    out: :subscription\n\n  step RegenerateSubscriptionTokens\n    in: :subscription,\n    out: :tokens\n\n  step UploadSubscriptionTokens\n    in: :subscription,\n    out: :tokens\n\n  # ...\nend\n"))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Prepare a common template for a service with ",(0,s.kt)("inlineCode",{parentName:"p"},"or")," conditionals."),(0,s.kt)("p",{parentName:"li"},"Here it is for our particular case:"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-ruby"},"class IsAuthorizedForSubscriptionRefresh\n  include ::ConvenientService::Standard::Config\n\n  attr_reader :user, :subscription_id\n\n  def initialize(:user, :subscription_id)\n    @user = user\n    @subscription_id = subscription_id\n  end\n\n  def result\n    # TODO: Implement\n  end\n\n  private\n\n  def is_super_admin_result\n    @is_super_admin_result ||= IsSuperAdmin.result(user: user)\n  end\n\n  def has_ability_result\n    @has_ability_result ||= HasAbility.result(user: user, ability: :refresh_someone_else_subscription)\n  end\n\n  def is_subscription_owner_result\n    @is_subscription_owner_result ||= IsSubscriptionOwner.result(user: user, subscription_id: subscription_id)\n  end\nend\n"))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Implement the ",(0,s.kt)("inlineCode",{parentName:"p"},"result")," method."),(0,s.kt)("p",{parentName:"li"},"Before we move on to the final polished chuck of code, let's discuss the common anti-patterns."),(0,s.kt)("p",{parentName:"li"},"Please, welcome ",(0,s.kt)("a",{parentName:"p",href:"https://lawyerdev.medium.com/i-never-write-nested-ifs-e4e91a5440ee"},"deeply nested if statements")," and ",(0,s.kt)("a",{parentName:"p",href:"/best_practices/service_has_only_one_success"},"multiple success calls"),"."),(0,s.kt)("h3",{parentName:"li",id:"zombie-version-"},"Zombie version \ud83e\udddf"),(0,s.kt)("pre",{parentName:"li"},(0,s.kt)("code",{parentName:"pre",className:"language-ruby"},'# bad - zombie\ndef result\n  if is_super_admin_result.not_success?\n    if has_ability_result.not_success?\n      if is_subscription_owner_result.not_success?\n        error(\n          "All conditions are not satisfied:"\n            + " and "\n            + is_super_admin_result.message\n            + " and "\n            + has_ability_result.message\n            + " and "\n            + is_subscription_owner_result.message\n        )\n      else\n        success\n      end\n    else\n      success\n    end\n  else\n    success\n  end\nend\n')),(0,s.kt)("p",{parentName:"li"},'Although, this code is "perfect" from the performance point of view and it works exactly as needed according to the requirements...'),(0,s.kt)("p",{parentName:"li"},"Please, do not commit it."),(0,s.kt)("p",{parentName:"li"},"Just imagine what will happen with an additional fourth or fifth condition."),(0,s.kt)("p",{parentName:"li"},"How can we make it simpler and more readable?"),(0,s.kt)("p",{parentName:"li"},"Use ",(0,s.kt)("inlineCode",{parentName:"p"},"or_step"),"."),(0,s.kt)(i.Z,{groupId:"examples",mdxType:"Tabs"},(0,s.kt)(a.Z,{value:"source",label:"Source",default:!0,mdxType:"TabItem"},(0,s.kt)(o.Z,{language:"ruby",mdxType:"CodeBlock"},"\n        class CreateButton\n          include ConvenientService::Standard::Config\n          -\n          step CreateWebButtonFactory,\n            in: :app,\n            out: :button\n          -\n          or_step CreateAndroidButtonFactory,\n            in: :app,\n            out: {action: :button}\n          -\n          or_step CreateIosButtonFactory,\n            in: :app,\n            out: {control: :button}\n          -\n          or_step CreateDesktopButtonFactory,\n            in: :app,\n            out: {knob: :button}\n          -\n          step :result,\n            in: :app,\n            out: :button\n          -\n          attr_reader :app\n          -\n          def initialize(:app)\n            @app = app\n          end\n          -\n          def result\n            success(button: button)\n          end\n        end\n      ")),(0,s.kt)(a.Z,{value:"rspec",label:"RSpec",mdxType:"TabItem"},(0,s.kt)(o.Z,{language:"ruby",mdxType:"CodeBlock"},'\n        require "spec_helper"\n        -\n        RSpec.describe CreateButton do\n          include ConvenientService::RSpec::Matchers::Results\n          -\n          example_group "class methods" do\n            describe ".result" do\n              subject(:result) { described_class.result(app: app) }\n              -\n              let(:app) { App.new(platform: :cli) }\n              -\n              context "when `CreateButton` is NOT successful" do\n                context "when all alternatives are NOT successful" do\n                  it "returns intermediate step" do\n                    expect(result).to be_not_success.of_service(described_class).of_step(CreateDesktopButtonFactory)\n                  end\n                end\n              end\n              -\n              context "when `CreateButton` is successful" do\n                context "when `CreateWebButtonFactory` is successful" do\n                  let(:app) { App.new(platform: :web) }\n                  let(:button) { App::UI::Web::Button.new }\n                  -\n                  it "returns success" do\n                    expect(result).to be_success.with_data(button: button).of_service(described_class).of_step(:result)\n                  end\n                end\n                -\n                context "when `CreateAndroidButtonFactory` is successful" do\n                  let(:app) { App.new(platform: :android) }\n                  let(:button) { App::UI::Android::Action.new }\n                  -\n                  it "returns success" do\n                    expect(result).to be_success.with_data(button: button).of_service(described_class).of_step(:result)\n                  end\n                end\n                -\n                context "when `CreateIosButtonFactory` is successful" do\n                  let(:app) { App.new(platform: :ios) }\n                  let(:button) { App::UI::Ios::Control.new }\n                  -\n                  it "returns success" do\n                    expect(result).to be_success.with_data(button: button).of_service(described_class).of_step(:result)\n                  end\n                end\n                -\n                context "when `CreateDesktopButtonFactory` is successful" do\n                  let(:app) { App.new(platform: :desktop) }\n                  let(:button) { App::UI::Desktop::Knob.new }\n                  -\n                  it "returns success" do\n                    expect(result).to be_success.with_data(button: button).of_service(described_class).of_step(:result)\n                  end\n                end\n              end\n            end\n          end\n        end\n      '))))))}m.isMDXComponent=!0}}]);