"use strict";(self.webpackChunkconvenient_service_docs=self.webpackChunkconvenient_service_docs||[]).push([[6059],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=n.createContext({}),p=function(e){var t=n.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(r),f=a,h=u["".concat(o,".").concat(f)]||u[f]||d[f]||l;return r?n.createElement(h,i(i({ref:t},c),{},{components:r})):n.createElement(h,i({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=r.length,i=new Array(l);i[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<l;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},4850:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>p});var n=r(7462),a=(r(7294),r(3905));const l={slug:"/faq/why_both_failure_and_error",sidebar_position:1,title:"Why failures and errors? Why not just failure?"},i=void 0,s={unversionedId:"faq/why_both_failure_and_error",id:"faq/why_both_failure_and_error",title:"Why failures and errors? Why not just failure?",description:"Consider the following user story.",source:"@site/docs/faq/why_both_failure_and_error.mdx",sourceDirName:"faq",slug:"/faq/why_both_failure_and_error",permalink:"/faq/why_both_failure_and_error",draft:!1,editUrl:"https://github.com/marian13/convenient_service_docs/blob/main/docs/faq/why_both_failure_and_error.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{slug:"/faq/why_both_failure_and_error",sidebar_position:1,title:"Why failures and errors? Why not just failure?"},sidebar:"docs",previous:{title:"Frequently Asked Questions",permalink:"/category/frequently-asked-questions"},next:{title:"Is it possible to modify the step collection from a callback?",permalink:"/faq/is_it_possible_to_modify_step_collection_from_callback"}},o={},p=[],c={toc:p};function d(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Consider the following user story."),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"As a doctor I would like to see a list of the patient's allergies.")),(0,a.kt)("p",null,"The list is received from the third-party API."),(0,a.kt)("p",null,"Sometimes a controller for this task may be implemented as follows."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby",metastring:'title="controllers/allergies_controller.rb"',title:'"controllers/allergies_controller.rb"'},'class AllergiesController < ApplicationController\n  # ...\n  def index\n    # `response` is a `Hash`.\n    response = ApiClient.get(\n      "/allergies",\n      params: {patient_id: allowed_patient_id}\n    )\n\n    @allergies = response.dig(:data, :allergies)\n  end\nend\n')),(0,a.kt)("p",null,"And the corresponding view."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-erb",metastring:'title="views/allergies/index.html.erb"',title:'"views/allergies/index.html.erb"'},'<h2>Allergies</h2>\n\n<% if @allergies.present? %>\n  <% @allergies.each do |allergy| %>\n    <p>\n      <div>\n        Name: <%= allergy[:name] %>\n      </div>\n      <div>\n        Symptoms: <%= allergy[:symptoms].join(", ") %>\n      </div>\n    </p>\n  <% end %>\n<% else %>\n  <span>\n    Patient has no allergies.\n  </span>\n<% end %>\n')),(0,a.kt)("p",null,"The code may look innocent from the first point of view, but the devil is in the details."),(0,a.kt)("p",null,"In a case, the API response has an unexpected format ",(0,a.kt)("inlineCode",{parentName:"p"},"response.dig(:data, :allergies)"),", returns ",(0,a.kt)("inlineCode",{parentName:"p"},"nil"),"."),(0,a.kt)("p",null,"Then ",(0,a.kt)("inlineCode",{parentName:"p"},"@allergies.present?")," is evaluated as ",(0,a.kt)("inlineCode",{parentName:"p"},"false")," in the view."),(0,a.kt)("p",null,"As a consequence, the ",(0,a.kt)("inlineCode",{parentName:"p"},'"Patient has no allergies"')," string is displayed in the doctor's browser."),(0,a.kt)("p",null,"Just try to imagine what may happen when a doctor blindly relies on the page text \ud83d\ude2c?"),(0,a.kt)("p",null,"Unfortunately, a code with similar problems sometimes may be written even by senior developers \ud83d\ude22."),(0,a.kt)("p",null,"That is the main reason of why ",(0,a.kt)("a",{parentName:"p",href:"/"},"ConvenientService")," differentiate ",(0,a.kt)("a",{parentName:"p",href:"/basics/failures"},"failures")," and ",(0,a.kt)("a",{parentName:"p",href:"/basics/errors"},"errors"),"."),(0,a.kt)("p",null,"Sure, the lib still can NOT 100% guarantee the complete elimination of the issue."),(0,a.kt)("p",null,"However it encourages the users to think about fallbacks and split the failures and errors from the beginning."),(0,a.kt)("p",null,"The curiosity or the confusion that the people feel when they find it difficult to decide whether to use a ",(0,a.kt)("a",{parentName:"p",href:"/basics/failures"},"failure")," or an ",(0,a.kt)("a",{parentName:"p",href:"/basics/errors"},"error")," works as a provocation for them to open and read this article."),(0,a.kt)("p",null,"This way they become aware of the issue and share it with others more frequently."),(0,a.kt)("p",null,"Refactoring using ",(0,a.kt)("a",{parentName:"p",href:"/"},"ConvenientService")," is the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby",metastring:'title="controllers/allergies_controller.rb"',title:'"controllers/allergies_controller.rb"'},'class FetchAllergies\n  include ::ConvenientService::Standard::Config\n  # ...\n  def result\n    return error("API response does not have `data` key") unless response.has_key?(:data)\n    return error("API response data does not have `allergies` key") unless response[:data].has_key?(:allergies)\n\n    return failure("Patient `#{allowed_patient_id}` has no allergies") if response[:data][:allergies].empty?\n\n    success(allergies: response[:data][:allergies])\n  end\n\n  private\n\n  def response\n    # `response` is a `Hash`.\n    @response ||= ApiClient.get("/allergies", params: {patient_id: allowed_patient_id})\n  end\nend\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby",metastring:'title="controllers/allergies_controller.rb"',title:'"controllers/allergies_controller.rb"'},"class AllergiesController < ApplicationController\n  # ...\n  def index\n    @fetch_allergies_result = FetchAllergies.result(allowed_patient_id: allowed_patient_id)\n  end\nend\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-erb",metastring:'title="views/allergies/index.html.erb"',title:'"views/allergies/index.html.erb"'},'<h2>Allergies</h2>\n\n<% if @fetch_allergies_result.success? %>\n  <% @fetch_allergies_result.data[:allergies].each do |allergy| %>\n    <p>\n      <div>\n        Name: <%= allergy[:name] %>\n      </div>\n      <div>\n        Symptoms: <%= allergy[:symptoms].join(", ") %>\n      </div>\n    </p>\n  <% end %>\n<% elsif @fetch_allergies_result.failure? %>\n  <span>\n    Patient has no allergies.\n  </span>\n<% else # @fetch_allergies_result.error? %>\n  <span>\n    No allergies information available.\n  </span>\n  <div>\n    Try to refresh the page after a while.\n  <div>\n  <div>\n    If the issue persists please contact the support.\n  </div>\n<% end %>\n')),(0,a.kt)("p",null,"The code is more verbose, but that is the price of realability."))}d.isMDXComponent=!0}}]);