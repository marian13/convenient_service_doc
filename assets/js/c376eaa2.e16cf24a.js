"use strict";(self.webpackChunkconvenient_service_docs=self.webpackChunkconvenient_service_docs||[]).push([[7465],{8549:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>o});var t=i(4848),s=i(8453);const r={slug:"/troubleshooting/added_config_but_middleware_never_called",sidebar_position:4,title:"My plugin is added to the config, but its middleware is never called"},d=void 0,a={id:"troubleshooting/added_config_but_middleware_never_called",title:"My plugin is added to the config, but its middleware is never called",description:"Some plugins are order-dependent.",source:"@site/docs/troubleshooting/added_config_but_middleware_never_called.mdx",sourceDirName:"troubleshooting",slug:"/troubleshooting/added_config_but_middleware_never_called",permalink:"/troubleshooting/added_config_but_middleware_never_called",draft:!1,unlisted:!1,editUrl:"https://github.com/marian13/convenient_service_docs/blob/main/docs/troubleshooting/added_config_but_middleware_never_called.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{slug:"/troubleshooting/added_config_but_middleware_never_called",sidebar_position:4,title:"My plugin is added to the config, but its middleware is never called"},sidebar:"docs",previous:{title:"I18n.translate wrong number of arguments",permalink:"/troubleshooting/i18n_translate_wrong_number_of_arguments"},next:{title:"Glossary",permalink:"/category/glossary"}},c={},o=[];function l(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Some plugins are order-dependent."}),"\n",(0,t.jsxs)(n.p,{children:["For example, ",(0,t.jsx)(n.code,{children:"CanHaveConnectedSteps"})," has a middleware for the instance ",(0,t.jsx)(n.code,{children:"result"})," method in the ",(0,t.jsxs)(n.a,{href:"https://github.com/marian13/convenient_service/blob/main/lib/convenient_service/service/configs/standard.rb",children:[(0,t.jsx)(n.code,{children:"Standard"})," config"]}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"middlewares :result do\n  # ...\n  use Plugins::Service::CanHaveConnectedSteps::Middleware\n  # ...\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If your plugin enhances the instance ",(0,t.jsx)(n.code,{children:"result"})," method as well, you may be affected by ",(0,t.jsx)(n.code,{children:"CanHaveConnectedSteps"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["How? Let's check its ",(0,t.jsx)(n.a,{href:"https://github.com/marian13/convenient_service/blob/main/lib/convenient_service/service/plugins/can_have_connected_steps/middleware.rb",children:"source"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"module ConvenientService\n  module Service\n    module Plugins\n      module CanHaveConnectedSteps\n        class Middleware < Core::MethodChainMiddleware\n          # highlight-start\n          def next(...)\n            return chain.next(...) if entity.steps.none?\n            # ...\n            entity.steps.result\n          end\n          # highlight-end\n          # ...\n        end\n      end\n    end\n  end\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:["It works as a ",(0,t.jsx)(n.a,{href:"/glossary/advanced/proxy_middleware",children:"proxy middleware"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["When a service has no steps, ",(0,t.jsx)(n.code,{children:"CanHaveConnectedSteps"})," just calls what is next in the middleware chain, by ",(0,t.jsx)(n.code,{children:"chain.next(...)"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Otherwise, it returns the last completed step result."}),"\n",(0,t.jsxs)(n.p,{children:["Let's place, e.g. ",(0,t.jsx)(n.code,{children:"HasJSendResultParamsValidations::UsingActiveModelValidations"})," plugin after ",(0,t.jsx)(n.code,{children:"CanHaveConnectedSteps"})," in your ",(0,t.jsx)(n.a,{href:"/tldr",children:"application service config"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"module ApplicationService\n  module Config\n    include ConvenientService::Concern\n    -\n    included do\n      # highlight-start\n      include ConvenientService::Standard::Config\n      # ...\n      middlewares :result do\n        use ConvenientService::Plugins::Service::HasJSendResultParamsValidations::UsingActiveModelValidations::Middleware\n      end\n      # highlight-end\n    end\n  end\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This way ",(0,t.jsx)(n.code,{children:"HasJSendResultParamsValidations::UsingActiveModelValidations"})," is never called for services with steps."]}),"\n",(0,t.jsxs)(n.p,{children:["To fix that, locate it before ",(0,t.jsx)(n.code,{children:"CanHaveConnectedSteps"})," like so:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"module ApplicationService\n  module Config\n    include ConvenientService::Concern\n    -\n    included do |service_class|\n      service_class.class_exec do\n        include ConvenientService::Standard::Config\n        # ...\n        middlewares :result do\n          # highlight-start\n          insert_before \\\n            ConvenientService::Plugins::Service::CanHaveConnectedSteps::Middleware,\n            ConvenientService::Plugins::Service::HasJSendResultParamsValidations::UsingActiveModelValidations::Middleware\n          # highlight-end\n        end\n      end\n    end\n  end\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Apart from ",(0,t.jsx)(n.a,{href:"https://github.com/Ibsciss/ruby-middleware/tree/v0.4.2#insert-before",children:"insert_before"}),", ",(0,t.jsx)(n.a,{href:"https://github.com/Ibsciss/ruby-middleware/tree/v0.4.2#insert-after",children:"insert_after"}),", ",(0,t.jsx)(n.a,{href:"https://github.com/Ibsciss/ruby-middleware/tree/v0.4.2#insert-after-each",children:"insert_after_each"}),", ",(0,t.jsx)(n.a,{href:"https://github.com/Ibsciss/ruby-middleware/tree/v0.4.2#insert-before-each",children:"insert_before_each"}),", ",(0,t.jsx)(n.a,{href:"https://github.com/Ibsciss/ruby-middleware/tree/v0.4.2#replace",children:"replace"}),", and ",(0,t.jsx)(n.a,{href:"https://github.com/Ibsciss/ruby-middleware/tree/v0.4.2#delete",children:"delete"})," are also available."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>a});var t=i(6540);const s={},r=t.createContext(s);function d(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);